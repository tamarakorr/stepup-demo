<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="Tammy Orr">
    <link rel="icon" href="../../favicon.ico">

    <title>StepUp Demo | <%= yield(:title) %></title>
  </head>

  <body>
    <!-- Map-->
    <div>
      <div id="map" style='width: 100%; height: 400px; margin-top:-10px;'></div>
    </div>

    <!-- Top Vacancies-->
    <!-- TODO Needs refactored (to external process) -->
    <ul class="list-group pull-left small" style="position: absolute; top: 120px; right: 100px;">
       <a href="#" class="list-group-item active small">
         Top Vacancies
       </a>
       <% top_vacs = Vacancy.select("service, count(*) as vac_count").where("is_active").group("service").order("vac_count DESC").limit(3).to_a %>
       <% top_vacs.each.with_index(1) do |vac, index| %>
        <li class="list-group-item small"><%= index.to_s + "   " + vac.service + " (" + vac.vac_count.to_s + ")" %></li>
       <% end %>
    </ul>

    <div class="container" style="padding-top:60px;">
      <div class="row">
        <!--Browse Vacancies-->
        <div class="col-md-4">
          <%= button_to 'Browse Vacancies', 'vacancies', :class => "btn btn-primary btn-lg", :method => :get %>
        </div>
        <!--Browse Volunteers-->
        <div class="col-md-4">
          <%= button_to "Browse Volunteers", 'volunteers', :class => "btn btn-primary btn-lg", :method => :get %>
       </div>
       <!--More Info-->
        <div class="col-md-4">
          <p><a class="btn btn-primary btn-lg" href="#" role="button">More Info</a></p>
        </div>
      </div>

      <!--Footer-->
      <%= render 'layouts/footer' %>
    </div> <!-- /container -->


    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="../../dist/js/bootstrap.min.js"></script>

    <!-- Gmaps4Rails scripts (see https://github.com/apneadiving/Google-Maps-for-Rails) -->
    <script src="//maps.google.com/maps/api/js?v=3.13&amp;sensor=false&amp;libraries=geometry" type="text/javascript"></script>
    <script src='//google-maps-utility-library-v3.googlecode.com/svn/tags/markerclustererplus/2.0.14/src/markerclusterer_packed.js' type='text/javascript'></script>
    <script src='underscore-min.js' type='text/javascript'></script>

    <!-- Draws the map! -->
    <!-- TODO (Refactoring obviously needed)-->
    <script type='text/javascript'>
      var myOptions = {
      zoom: 3,
      center: new google.maps.LatLng(51.5072, 0.1275),
      mapTypeId: google.maps.MapTypeId.ROADMAP,
      styles: [{"elementType":"labels.text","stylers":[{"visibility":"off"}]},{"featureType":"road","stylers":[{"visibility":"off"}]},{"featureType":"transit","stylers":[{"visibility":"off"}]},{"featureType":"administrative.province","stylers":[{"visibility":"off"}]},{"featureType":"poi.park","elementType":"geometry","stylers":[{"visibility":"off"}]},{"featureType":"water","stylers":[{"color":"#004b76"}]},{"featureType":"landscape.natural","stylers":[{"visibility":"on"},{"color":"#fff6cb"}]},{"featureType":"administrative.country","elementType":"geometry.stroke","stylers":[{"visibility":"off"},{"color":"#7f7d7a"},{"lightness":10},{"weight":1}]}]
      };

      var map = new google.maps.Map(document.getElementById('map'), myOptions);
      
      // Markers must be added *after* the map is constructed.
      <% Vacancy.all.each do |vac| %>
        
        <% if ! (vac.latitude.nil? || vac.longitude.nil?) %>
          var marker_title = "<%= vac.title + " - " + vac.work_region %>";
          var myLatlng = new google.maps.LatLng(<%= vac.latitude %>, <%= vac.longitude %>);
          var marker = new google.maps.Marker({
            position: myLatlng,
            map: map,
            title: marker_title,
            icon: "<%= asset_path('red.png') %>"
          });
        <% end %>
      <% end %>
    </script>
    <!--End drawing the map!-->
  </body>
</html>
